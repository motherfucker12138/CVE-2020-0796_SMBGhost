srvnet!PplpCreateOneLookasideList:
; save registers
fffff802`7db8cf98 488bc4          mov     rax,rsp
fffff802`7db8cf9b 48895808        mov     qword ptr [rax+8],rbx
fffff802`7db8cf9f 48896810        mov     qword ptr [rax+10h],rbp
fffff802`7db8cfa3 48897018        mov     qword ptr [rax+18h],rsi
fffff802`7db8cfa7 48897820        mov     qword ptr [rax+20h],rdi
fffff802`7db8cfab 4156            push    r14
; local var space
fffff802`7db8cfad 4883ec40        sub     rsp,40h
; [rsp+88h] here is the same as 0x88 - 0x40 - 0x10 -> rsp+0x38 in caller
; param -> esi in caller
; r8 -> 0x6662534C
fffff802`7db8cfb1 448b842488000000 mov     r8d,dword ptr [rsp+88h]
; function addr transfer to rsi
; `srvnet!SrvNetBufferLookasideFree`
fffff802`7db8cfb9 488bf2          mov     rsi,rdx
; function addr transfer to rbp
; `srvnet!SrvNetBufferLookasideAllocate`
fffff802`7db8cfbc 488be9          mov     rbp,rcx
; ebx -> 0x80
fffff802`7db8cfbf bb80000000      mov     ebx,80h
; edx -> 0x80
fffff802`7db8cfc4 8bd3            mov     edx,ebx
; init r9 to 0
fffff802`7db8cfc6 4533c9          xor     r9d,r9d
; ecx -> 0x204
fffff802`7db8cfc9 b904020000      mov     ecx,204h
fffff802`7db8cfce 4c8b15a3540200  mov     r10,qword ptr [srvnet!_imp_ExAllocatePoolWithTagPriority (fffff802`7dbb2478)]
; again 
fffff802`7db8cfd5 e8b6d5cbfa      call    nt!ExAllocatePoolWithTagPriority (fffff802`7884a590)
fffff802`7db8cfda 4533f6          xor     r14d,r14d
fffff802`7db8cfdd 488bf8          mov     rdi,rax
fffff802`7db8cfe0 4885c0          test    rax,rax
fffff802`7db8cfe3 0f8496000000    je      srvnet!PplpCreateOneLookasideList+0xe7 (fffff802`7db8d07f)  Branch

srvnet!PplpCreateOneLookasideList+0x51:
fffff802`7db8cfe9 448bc3          mov     r8d,ebx
fffff802`7db8cfec 33d2            xor     edx,edx
fffff802`7db8cfee 488bc8          mov     rcx,rax
; allocate memory and init
fffff802`7db8cff1 e88a4e0000      call    srvnet!memset (fffff802`7db91e80)
; [rsp+90h] here is the same as 0x90 - 0x40 - 0x10 -> rsp+0x40 in caller
; param -> rax in caller
; rcx -> 0x0
fffff802`7db8cff6 488b8c2490000000 mov     rcx,qword ptr [rsp+90h]
; [rsp+98h] here is the same as 0x98 - 0x40 - 0x10 -> rsp+0x48 in caller
; param -> mov     byte ptr [rsp+48h],1 
; bl -> 1
fffff802`7db8cffe 8a9c2498000000  mov     bl,byte ptr [rsp+98h]
fffff802`7db8d005 48894f60        mov     qword ptr [rdi+60h],rcx
fffff802`7db8d009 488d4f68        lea     rcx,[rdi+68h]
; allocate buffer offset 0x70
fffff802`7db8d00d 885f70          mov     byte ptr [rdi+70h],bl
fffff802`7db8d010 4c8b1581540200  mov     r10,qword ptr [srvnet!_imp_KeInitializeSpinLock (fffff802`7dbb2498)]
fffff802`7db8d017 e804f1d1fa      call    nt!ExInitializePushLock (fffff802`788ac120)
fffff802`7db8d01c 84db            test    bl,bl
; bl is 0x1, so take the jump
fffff802`7db8d01e 751e            jne     srvnet!PplpCreateOneLookasideList+0xa6 (fffff802`7db8d03e)  Branch

srvnet!PplpCreateOneLookasideList+0x88:
fffff802`7db8d020 488bc7          mov     rax,rdi

srvnet!PplpCreateOneLookasideList+0x8b:
fffff802`7db8d023 488b5c2450      mov     rbx,qword ptr [rsp+50h]
fffff802`7db8d028 488b6c2458      mov     rbp,qword ptr [rsp+58h]
fffff802`7db8d02d 488b742460      mov     rsi,qword ptr [rsp+60h]
fffff802`7db8d032 488b7c2468      mov     rdi,qword ptr [rsp+68h]
fffff802`7db8d037 4883c440        add     rsp,40h
fffff802`7db8d03b 415e            pop     r14
fffff802`7db8d03d c3              ret

srvnet!PplpCreateOneLookasideList+0xa6:
; we come here now
; [rsp+78h] here is the same as 0x78 - 0x40 - 0x10 -> rsp+0x28 in caller
; param -> r12d in the caller, constant value
; eax -> 0x3030534C
fffff802`7db8d03e 8b442478        mov     eax,dword ptr [rsp+78h]
; passing parameters
; r9d -> 0x200
; [rsp+38h] -> 0
; r8 -> function `srvnet!SrvNetBufferLookasideFree` addr
; [rsp+30h] -> 0x3030534C
; rdx -> function `srvnet!SrvNetBufferLookasideAllocate` addr
	; rsp+70h is the same as 0x70 - 0x40 - 0x10 -> rsp+0x20 in caller
	; rax -> something calculated in caller's caller loop
; rcx -> allocated buffer
; [rsp+28h] -> rax
; [rsp+20h] -> 0
fffff802`7db8d042 41b900020000    mov     r9d,200h
fffff802`7db8d048 664489742438    mov     word ptr [rsp+38h],r14w
fffff802`7db8d04e 4c8bc6          mov     r8,rsi
fffff802`7db8d051 89442430        mov     dword ptr [rsp+30h],eax
fffff802`7db8d055 488bd5          mov     rdx,rbp
fffff802`7db8d058 488b442470      mov     rax,qword ptr [rsp+70h]
fffff802`7db8d05d 488bcf          mov     rcx,rdi
fffff802`7db8d060 4889442428      mov     qword ptr [rsp+28h],rax
fffff802`7db8d065 4489742420      mov     dword ptr [rsp+20h],r14d
fffff802`7db8d06a 4c8b15d7570200  mov     r10,qword ptr [srvnet!_imp_ExInitializeLookasideListEx (fffff802`7dbb2848)]
; step in
fffff802`7db8d071 e8faa2cefa      call    nt!ExInitializeLookasideListEx (fffff802`78877370)
fffff802`7db8d076 85c0            test    eax,eax
fffff802`7db8d078 79a6            jns     srvnet!PplpCreateOneLookasideList+0x88 (fffff802`7db8d020)  Branch

srvnet!PplpCreateOneLookasideList+0xe2:
fffff802`7db8d07a e993a00000      jmp     srvnet!PplpCreateOneLookasideList+0xa17a (fffff802`7db97112)  Branch

srvnet!PplpCreateOneLookasideList+0xe7:
fffff802`7db8d07f 33c0            xor     eax,eax
fffff802`7db8d081 eba0            jmp     srvnet!PplpCreateOneLookasideList+0x8b (fffff802`7db8d023)  Branch

srvnet!PplpCreateOneLookasideList+0xa17a:
fffff802`7db97112 8b942488000000  mov     edx,dword ptr [rsp+88h]
fffff802`7db97119 488bcf          mov     rcx,rdi
fffff802`7db9711c 4c8b15adb70100  mov     r10,qword ptr [srvnet!_imp_ExFreePoolWithTag (fffff802`7dbb28d0)]
fffff802`7db97123 e878effefa      call    nt!ExFreePool (fffff802`78b860a0)
fffff802`7db97128 90              nop
fffff802`7db97129 e9515fffff      jmp     srvnet!PplpCreateOneLookasideList+0xe7 (fffff802`7db8d07f)  Branch
